<!DOCTYPE html>
<html lang="ru">
<head>
	<title>7 –ª–µ—Ç –±–µ–∑ ¬´—Ñ—Ä–µ–π–º–æ—Ä–∫–∞¬ª</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=792, user-scalable=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<link rel="stylesheet" href="../../shwr/styles/screen.css">

	<style>
		.slide .next.shade {
			opacity: 1;
			position: absolute;
			left: 0;
			right: 0;
			bottom: 0;
			background: #fff;
			transition: all .5s;
		}
		.slide .next.active.shade {
			opacity: 0;
		}
	</style>
</head>
<body class="list">

	<header class="caption">
		<h1>7 –ª–µ—Ç –±–µ–∑ ¬´—Ñ—Ä–µ–π–º–æ—Ä–∫–∞¬ª</h1>
		<p></p>
	</header>

	<section class="slide shout"><div>
		<h2>7 –ª–µ—Ç –±–µ–∑ ¬´—Ñ—Ä–µ–π–º–æ—Ä–∫–∞¬ª</h2>
	</div></section>

	<section class="slide cover"><div>
		<img src="media/BootScheme.png" height="100%" style="margin-left: 100px; margin-top: 40px;"/>
	</div></section>

	<section class="slide shout"><div>
		<h2>–î–∞–Ω–Ω—ã–µ –∏ API</h2>
	</div></section>

	<section class="slide cover"><div>
		<img src="media/apidoc-index.png" width="100%"/>
	</div></section>

	<section class="slide cover"><div>
		<img src="media/apidoc-variants.png" width="100%"/>
	</div></section>

	<section class="slide"><div>
		<h2>–î–∞–Ω–Ω—ã–µ –∏ API</h2>
		<ul>
			<li>–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞</li>
			<li>–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
			<li>–°–æ–≥–ª–æ—Å–æ–≤–∞–Ω–∏–µ</li>
			<li>–û—Ç–ø—Ä–∞–≤–∫–∞ Pull Request</li>
			<li>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è*</li>
			<li>–ü–æ–∫—Ä—ã—Ç–∏–µ –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞–º–∏*</li>
		</ul>
		<p style="text-align: right;">* ‚Äî backend</p>
	</div></section>

	<section class="slide shout"><div>
		<h2>–†–∞–Ω—å—à–µ</h2>
	</div></section>

	<section class="slide cover"><div>
		<img src="media/api-flow.png" height="90%" style="margin-left: 90px; margin-top: 60px;"/>

		<div class="next shade" style="top: 170px;"></div>
		<div class="next shade" style="top: 210px;"></div>
		<div class="next shade" style="top: 250px;"></div>
		<div class="next shade" style="top: 290px;"></div>
		<div class="next shade" style="top: 330px;"></div>
		<div class="next shade" style="top: 360px;"></div>

		<div class="next shade" style="top: 400px;">
			<div style="position: absolute; background: #fff; top: -30px; height: 40px; width: 550px; right: 0;"></div>
		</div>
	</div></section>

	<section class="slide"><div>
		<h2>–í –∏—Ç–æ–≥–µ —Ä–∞–Ω—å—à–µ –Ω–∞–¥–æ –±—ã–ª–æ</h2>
		<ul>
			<li>–†–∞–∑–±–æ—Ä –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ (–Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –∏—Ö 25)</li>
			<li>–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –∏ –µ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</li>
			<li>–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å api</li>
		</ul>
	</div></section>

	<section class="slide shout"><div>
		<h2>JSSDK</h2>
	</div></section>

	<section class="slide"><div>
		<h2>JSSDK: –°—Ç–∞–ª–æ</h2>
		<ul>
			<li>–†–∞–±–æ—Ç–∞ —Å API —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ú–æ–¥–µ–ª–∏</li>
			<li>–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏—è –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã</li>
			<li>–ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –≤—Å–µ–π –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∏ –∏ —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å</li>
			<li>–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø—Ä–æ–µ–∫—Ç–∞</li>
			<li>–¢–µ—Å—Ç—ã</li>
			<li>–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</li>
		</ul>
	</div></section>

	<section class="slide cover"><div>
		<img src="media/jssdk-core.png" height="90%" style="margin-left: 90px; margin-top: 30px;"/>
	</div></section>

	<section class="slide"><div>
		<h2>JSSDK: Thread</h2>
		<pre class="js-code">
			// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–¥–æ–≤
			Thread.find({folder: 8}).then(threads => {
				// ...
			});
		</pre>
	</div></section>

	<section class="slide cover"><div>
		<img src="media/jssdk-api-flow.png" height="90%" style="margin-left: 60px; margin-top: 30px;"/>
	</div></section>

	<section class="slide"><div>
		<h2>–ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞</h2>
		<pre class="js-code compact">
			RPC.intercept({
				#! status: "invalid",
				#!+ process(req) {
					#!+ if (req.get("body.folder.error") === "not_open") {
							// –í–æ–∑–≤—Ä–∞—â–∞–µ–º Promise
						return openSecureFolderLayer({
							folder: req.get("body.folder.value")
						});
					#!- }
				#!- }
			});
		</pre>
	</div></section>

	<section class="slide cover"><div>
		<h2 style="font-size: 500%; margin-top: 80px;">~2K assertions</h2>
		<img src="media/jssdk-coverage.png" width="100%"/>
	</div></section>

	<section class="slide cover"><div>
		<h2 style="font-size: 800%; margin-top: 80px;">JSDoc</h2>
		<img src="media/jssdk-docs.png" width="100%"/>
	</div></section>

	<section class="slide cover"><div>
		<img src="media/jssdk-docs-2.png" width="100%"/>
	</div></section>

	<section class="slide"><div>
		<h2>JSSDK: Models</h2>
		<ul>
			<li><b>–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</b></li>
			<li><b>–†–∞–±–æ—Ç–∞ —Å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</b> ‚Äî –æ–± —ç—Ç–æ–º —á—É—Ç—å –ø–æ–∑–∂–µ</li>
			<li><b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π</b></li>
			<li><b>–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</b></li>
			<li>–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
			<li>–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</li>
			<li>–í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤</li>
			<li>–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2>Model: –ú–µ—Ç–æ–¥—ã –ø–æ–ª—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏</h2>
		<ul>
			<li><b>find</b>(query) ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π</li>
			<li><b>findOne</b>(id) / findOne(query) ‚Äî –º–æ–¥–µ–ª—å –ø–æ id –∏–ª–∏ –Ω–µ–∫–æ–º—É —É—Å–ª–æ–≤–∏—é</li>
			<li><b>get</b>(id) ‚Äî –ø–æ–ª—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –∏–∑ RuntimeCache (–µ—Å–ª–∏ –µ—Å—Ç—å)</li>
			<li><b>getSafe</b>(id) ‚Äî –ø–æ–ª—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –µ—ë –Ω–∞–ª–∏—á–∏—è</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2>new Model(): –ë–∞–∑–æ–≤—ã–π –∏–Ω—Ç—Ä–µ–π—Ñ–µ–π—Å –º–æ–¥–µ–ª–∏</h2>
		<ul>
			<li><b>isNew</b>() - —è–≤—è–ª–µ—Ç—Å—è –ª–∏ –º–æ–¥–µ–ª—å ¬´–Ω–æ–≤–æ–π¬ª?</li>
			<li><b>isDataFully</b>([query]) - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω–æ—Ç—É –¥–∞–Ω–Ω—ã—Ö</li>
			<li><b>is</b>(name) ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –∏—Å—Ç–∏–Ω–æ—Å—Ç—å</li>
			<li><b>get</b>(name) ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ</li>
			<li><b>set</b>(name, value) - –∏–∑–º–µ–Ω–∏—Ç—å</li>
			<li><b>previous</b>(name) - –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</li>
			<li>...etc</li>
		</ul>
		<p style="text-align: right; margin-top: -30px;">
			* <b>name</b> ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç dot-–Ω–æ—Ç–∞—Ü–∏—é
		</p>
	</div></section>

	<section class="slide"><div>
		<h2>Backbone –∏ –µ–≥–æ –ø—Ä–æ–±–ª–µ–º—ã</h2>
		<pre class="js-code compact-s">
			const listFoo = new BackboneTheadCollection({folder: 123});
			listFoo.fetch();

			const listBar = new BackboneTheadCollection({folder: 123});
			listBar.fetch();

			#!+ console.log(listFoo.get(456) === listBar.get(456));
			// false :[

			listFoo.on("chnage", () => { console.log("Cnanged"); });
			listBar.get(456).set("flag", true);
			#!- // –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏–Ω—Å—Ç–∞–Ω—Å—ã —Ä–∞–∑–Ω—ã–µ
		</pre>
	</div></section>

	<section class="slide"><div>
		<h2>JSSDK: –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</h2>
		<pre class="js-code compact-s">
			// –ì–¥–µ-—Ç–æ –ø–æ–ª—É—á–∞–µ–º —Ç—Ä–µ–¥
			Thread.findOne(123).then(thread => {
				thread.get("messages").on("change:flags", () => {
					// –†–µ–∞–≥–∏—Ä—É–µ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤
				});
			});

			#!+ // –ì–¥–µ-—Ç–æ –ø–∏—Å—å–º–æ (–∫–æ—Ç–æ—Ä–æ–µ –≤—Ö–æ–¥–∏—Ç –≤ —Ç—Ä–µ–¥)
			Message.findOne(345).then(message => {
				#!+ // –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ñ–ª–∞–≥ (–º—ã —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞–µ–º :])
				#!- message.set("flags.unread", !message.is("flags.unread"));
			#!- });
		</pre>
		<div class="next">
			<img src="media/arrow-rdu.png" style="
				position: absolute;
				right: 150px;
				top: 260px;
				transform: rotateZ(-10deg);
			"/>
		</div>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -50px">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π</h2>
		<pre class="js-code">
			const Thread = Message.extend({
				className: "mail.Thread", // –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
				findUrl: "threads", // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç—Ä–µ–¥–æ–≤
				findOneUrl: "threads/thread", // –ó–∞–ø—Ä–æ—Å –∑–∞ —Ç—Ä–µ–¥–æ–º
				defaults: { // –°–≤–æ–π—Å—Ç–≤–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
					...
					<mark>messages: new Message.List.Sorted</mark>,
				}
			});
		</pre>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -50px">–í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤</h2>
		<pre class="js-code compact-s">
			// –ü–∏—Å—å–º–æ
			const Message = RPCModel.extends({
				defaults: {
					...
					attachments: new Attachment.List.Local(),
				},
				// –í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
				valueValidator(newValue, attr, newAttrs, model) {
					return <mark>check(model, attr, newValue)</mark> ? newValue : model.get(attr);
				}
			});

			#!+ // –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
			Message.List.Sorted = Message.List.extend({
				comparator: {date: true} // desc
			#!- });
		</pre>
	</div></section>

	<section class="slide shout"><div>
		<h2 style="font-size: 500%">–ù–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -50px">–ù–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
		<pre class="js-code compact">
			const Thread = Message.extend({
				<s>findOneUrl: "threads/thread"</s>
				findOneUrl: (query) => query.withoutQuote
						? "threads/thread/short"
						: "threads/thread"
				},
				isDataFully(query) {
					#!+ return this.is("messages.length") && (
							query.withoutQuote || hasQuotes(this)
					#!- );
				}
			});
		</pre>
	</div></section>

	<section class="slide cover"><div>
		<img src="media/jssdk-thread-flow.png" height="95%" style="margin-left: 30px; margin-top: 30px;"/>
		<div class="next shade" style="top: 400px;"></div>
	</div></section>

	<section class="slide shout"><div>
		<h2>–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
	</div></section>

	<section class="slide cover"><div>
		<pre class="js-code" style="
			top: -60px;
			left: -20px;
			right: 0;
			padding-left: 150px;
			position: absolute;
			box-shadow: 0 1px;
			border-bottom: 2px solid #333;
		">
			Client.find().then(list => ...);
		</pre>
		<img src="media/o2app.png" width="100%"/>
		<style>
			.o2-steps {
				position: absolute;
				width: 100%;
				top: 0;
				left: 0;
				bottom: 0;
			}
			.o2-steps > div {
				background: #fff;
				position: absolute;
				width: 100%;
				left: 0;
				bottom: 0;
				transition: opacity .3s;
			}
			.full .o2-steps > .next {opacity: 1;}
			.full .o2-steps > .next.active {opacity: 0;}
			.o2-01 {top: 41%;}
			.o2-02 {top: 48%;}
			.o2-03 {top: 70%;}
		</style>
		<div class="o2-steps">
			<div class="o2-01 next"></div>
			<div class="o2-02 next"></div>
			<div class="o2-03 next"></div>
		</div>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -50px;">–û—à–∏–±–∫–∏</h2>
		<pre class="js-code compact-xs">
			request.on("error", (evt, req) => {
				saveToLog(req);
			});
		</pre>

		<div style="display: flex; margin: -30px -70px 0 -20px; font-size: 87%;">
			<ul style="flex-basis: 45%;">
				<li><b>uuid</b>:`string` ‚Äî id –∑–∞–ø—Ä–æ—Å–∞</li>
				<li><b>url</b>:`string` ‚Äî —á—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∏</li>
				<li><b>type</b>:`string` ‚Äî GET, POST –∏ —Ç.–ø.</li>
				<li><b>data</b>:`Object` ‚Äî –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞</li>
				<li><b>options</b>:`Object` ‚Äî –û–ø—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞</li>
				<li><b>body</b>:`Object` ‚Äî –û—Ç–≤–µ—Ç (JSON)</li>
				<li><b>error</b>:`*` ‚Äî –û—à–∏–±–∫–∞</li>
				<li><b>responseText</b>:`*` ‚Äî raw-–æ—Ç–≤–µ—Ç</li>
			</ul>
			<ul>
				<li><b>startTime</b>:`number` ‚Äî –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø—Ä–æ—Å–∞</li>
				<li><b>endTime</b>:`number` ‚Äî –í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</li>
				<li><b>duration</b>:`number` ‚Äî –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞</li>
				<li><b>aborted</b>:`boolean` ‚Äî –û—Ç–º–µ–Ω–µ–Ω</li>
				<li><b>batched</b>:`boolean` ‚Äî –í ¬´–ø–∞—á–∫–µ¬ª
				<li><b>pending</b>:`boolean` ‚Äî –í –æ–∂–∏–¥–∞–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞</li>
				<li><b>retries</b>:`number` ‚Äî –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫</li>
			</ul>
		</div>
	</div></section>

	<section class="slide shout"><div>
		<h2>¬´–î–µ–π—Å—Ç–≤–∏–µ¬ª</h2>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -50px;">¬´–î–µ–π—Å—Ç–≤–∏–µ¬ª / Lifecycle</h2>
		<pre class="js-code compact">
			const MyAction = Action.extend(/** @lends MyAction# */{
				#!+ // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
				prepare(params, options)/* Promise|Object */ {
					return {computed: params.foo + params.bar};
				#!- },
				#!+ // –í—ã–ø–æ–ª–Ω—è–µ–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
				#!- operation({computed}, params, options) /* Promise */ { /* ‚Ä¶ */ },
				#!+ // –û–±—Ä–∞—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
				#!- undoOperation(data, params, options) /* Promise */ { /* ‚Ä¶ */  },
				#!+ // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
				#!- rollbackOperation() { }
			});
		</pre>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -50px;">–ü—Ä–∏–º–µ—Ä MoveTo</h2>
		<pre class="js-code compact-s">
			MoveTo.execute({
				folderTo: 123, // id –ø–∞–ø–∫–∏ –∫—É–¥–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏–º
				models: [...] // –ú–∞—Å—Å–∏–≤ –ü–∏—Å–µ–º –∏–ª–∏ –¢—Ä–µ–¥–æ–≤ (–º–æ–¥–µ–ª–∏)
			}).then(action => {
				// –°—Å—ã–ª–∫–∞ –Ω–∞ –º–æ–¥–µ–ª—å –ü–∞–ø–∫–∏ –∫—É–¥–∞ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏
				const folderTo = action.folderTo;

				// –°–ø–∏—Å–æ–∫ —Ä–µ–∞–ª—å–Ω–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
				const affectedModels = action.models;

				// –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –æ—Ç–º–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è
				showUndoNotify().onUndo(() => action.undo());
			});
		</pre>
	</div></section>

	<section class="slide cover"><div>
		<img src="media/jssdk-action-flow.png" width="90%" style="margin-top: 60px; margin-left: 55px;"/>
	</div></section>

	<section class="slide cover"><div>
		<h2 style="font-size: 700%; margin-top: 120px;">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h2>
		<img src="media/app-struct-shot-idx.png" width="100%"/>
	</div></section>

	<section class="slide cover"><div>
		<h2 style="font-size: 700%; margin-top: 120px;">–£—Å—Ç–∞–Ω–æ–≤–∫–∞</h2>
		<img src="media/octavius-readme-1.png" width="100%" style="margin-top: 40px;"/>
	</div></section>

	<section class="slide cover"><div>
		<h2 style="font-size: 600%; margin-top: 80px;">–û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è</h2>
		<img src="media/octavius-readme-2.png" width="100%"/>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -50px;">–¢–æ—á–∫–∞ –≤—Ö–æ–¥</h2>
		<pre class="js-code">
			require(["app/app", "logger"], function (app, logger) {
				// –°–∫—Ä—ã—Ç—å –ª–æ—É–¥–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
				app.ready(hideLoading);
				// –ü–µ—Ä–µ—Ö–≤–∞—Ç —Å—Å—ã–ª–æ–∫ –∏ –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
				app.listenFrom(document, {
					autoStart: true,
					logger: logger
				});
			});
		</pre>
	</div></section>

	<section class="slide shout"><div>
		<h2>–ß—Ç–æ —Ç–∞–∫–æ–µ app?</h2>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -50px">–ß—Ç–æ —Ç–∞–∫–æ–µ app?</h2>
		<pre class="js-code">
			const app = Pilot.create({
				#! model: { /* –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤—Å–µ–º –º–∞—Ä—à—Ä—É—Ç–∞–º */ },
				#!+ "#letters": {
					url: "/:folder", // "/inbox/", "/trash/" –∏–ª–∏ "/123/"
					#!+ model: { // –º–æ–¥–µ–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
						threads: ({params: {folder}}) => Thread.find({folder})
					#!- }
				#!- },
			});
		</pre>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -50px">–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ id</h2>
		<pre class="js-code">
			// –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –Ω—É–∂–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç
			app.go("#letters"); // "/inbox/"
			app.go("#letters", {folder: 123}); // "/123/"

			// –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å url
			app.getUrl("#letters", {folder: 0}); // "/inbox/"
			app.getUrl("#letters", {folder: 123}); // "/123/"

			// –ò–ª–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
			app.route.getUrl({folder: 0}); // "/inbox/"
		</pre>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -50px">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∞</h2>
		<pre class="js-code compact-s">
			"#letters": {
				url: {
					pattern: "/:folder", // <mark>"/inbox/"</mark>, "/trash/" –∏–ª–∏ <mark>"/123/"</mark>
					#!+ params: {
						folder: {
							#! default: Folder.INBOX,
							#! decode: (val) => (val in TYPE2ID) ? TYPE2ID[val] : toInt(val),
							#! encode: (id) => (id in ID2TYPE) ? ID2TYPE[id] : id,
						}
					#!- },
					#! toUrl: (params, builder) => builder({params, ...extra}),
				},
				model: { /*...*/ },
				// ...
			}
		</pre>
	</div></section>

	<section class="slide shout"><div>
		<h2>App Model</h2>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -40px;">App Model (aka dataSource)</h2>
		<pre class="js-code compact">
			console.dir(app.model);
			{
				request: Pilot.Request, // —Ç–µ–∫—É—â–∏–π ¬´location¬ª
				authUser: User, // –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π —é–∑–µ—Ä
				folder: Folder, // –∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–ø–∫–∞
				folders: Folder.List, // —Å–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫
				letters: Thread.List, // —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–¥–æ–≤ –∏–ª–∏ –ø–∏—Å–µ–º
				letter: Thread, // –∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–¥ (–Ω–∞ —á—Ç–µ–Ω–∏–∏)
				status: Object, // —Å—Ç–∞—Ç—É—Å —è—â–∏–∫–∞
				...
			}
		</pre>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -60px;">App Model (aka dataSource)</h2>
		<pre class="js-code compact-s">
			// –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
			import request from "./source/request";
			import authUser from "./source/authUser";
			import status from "./source/status";
			import folders from "./source/folders";
			// ...etc
			const loader = new Pilot.Loader({
				request,
				authUser,
				status,
				folders,
				// ...etc
			}, {
				/* —Ä–∞–∑–Ω—ã–µ –æ–ø—Ü–∏–∏ */
			});
		</pre>
	</div></section>

	<section class="slide"><div>
		<pre class="js-code" style="margin: -70px 0 0 0">
			// source/request.js
			export default {
				fetch: (req) => req,
			};
			#!+ // source/status.js  (!)
			export default {
				fetch: (req) => loadStatusByRequest(req),
				reaction(req, newStatus, event) {
					// –†–µ–∞–∫—Ü–∏—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
					// (–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ ¬´–î–µ–π—Å—Ç–≤–∏—è¬ª –Ω–∞–¥ –º–æ–¥–µ–ª—è–º–∏)
				}
			#!- };
		</pre>
	</div></section>

	<section class="slide"><div>
		<pre class="js-code compact-s" style="margin: -50px 0 0 -60px">
			// source/folders.js
			export default {
				fetch(req, **waitFor**) {
					return waitFor("status").then(status => status.folders);
				},
			};
			#!+ // source/folder.js
			export default {
				fetch(req, waitFor) {
					if (req.is("#read-letter")) { // –ï—Å–ª–∏ —ç—Ç–æ ¬´–ß—Ç–µ–Ω–∏–µ¬ª
						#!+ return Promise
							  .all([**waitFor("folders"), waitFor("letter")**])
						#!-	   .then(([folders, letter]) => folders.get(letter.get("folder")));
					} else {
						#! return waitFor("folders").then(folders => folders.get(req.params.folder));
					}
				}
			#!- };
		</pre>
	</div></section>

	<section class="slide"><div>
		<pre class="js-code">
			// source/letter.js
			export default {
				match: ["#read-letter", "#search-letter"],
				fetch: ({params:{letter}}) => Thread.findOne(letter),
			};
		</pre>
	</div></section>


	<section class="slide"><div>
		<h2>Pilot.Request</h2>
		<div style="display: flex; ">
			<ul style="width: 80%">
				<li><b>params</b> ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—Ä—à—Ä—É—Ç–∞</li>
				<li><b>query</b> ‚Äî GET-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã</li>
				<li><b>route</b> ‚Äî —Ç–µ–∫—É—â–∏–π –º–∞—Ä—à—Ä—É—Ç, route.is("#letters #search")</li>
				<li><b>router</b> ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ—É—Ç–µ—Ä</li>
			</ul>
			<ul style="width: 20%; font-size: 80%">
				<li>href</li>
				<li>protocol</li>
				<li>host</li>
				<li>hostname</li>
				<li>port</li>
				<li>pathname</li>
				<li>search</li>
				<li>hash</li>
				<li>referrer</li>
			</ul>
		</div>
	</div></section>

	<section class="slide"><div>
		<h2>UI + –î–∞–Ω–Ω—ã–µ</h2>
		<pre class="js-code compact">
			const app = Pilot.create(sitemap);
			#!+ // –°–æ–∑–¥–∞—ë–º AppView
			app.view = new UIApplication(dataSource.getData(), {
				router: app,
				dataSource,
			#!- });
			#!+ // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º View –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
			dataSource.onChange(data => {
				app.view.set(data);
			#!- });
		</pre>
	</div></section>

	<section class="slide shout"><div>
		<h2>UIApplication</h2>
	</div></section>

	<section class="slide cover"><div>
		<h2 style="font-size: 500%">–í—Å—ë –µ—Å—Ç—å –±–ª–æ–∫–∏</h2>
		<img src="media/app-struct-shot-dataset.png" width="95%" style="margin-left: 10px; margin-top: 50px;"/>
	</div></section>


	<section class="slide shout"><div>
		<h2 style="font-size: 350%">
			‚Äî –í—Å–µ –±–ª–æ–∫–∏ ¬´–≥–ª—É–ø—ã–µ¬ª <small style="font-size: 30%; vertical-align: middle">(–Ω—É –ø–æ—á—Ç–∏)</small><br/>
			<br/>
			‚Äî Attrs Down / Events Up &nbsp;
		</h2>
	</div></section>

	<section class="slide"><div>
		<h2>Attrs Down, Events Up</h2>
		<pre class="js-code">
			&lt;b:letter-status
				name="unread"
				state="{attrs.unread}"
				remit:<mark>click</mark>="<mark>invert:unread</mark>"
			/>
		</pre>
	</div></section>

	<section class="slide cover"><div>
		<img src="media/feast-button.png" width="100%"/>
	</div></section>

	<section class="slide"><div>
		<h2>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–ª–æ–∫–∞</h2>
		<code>/Button/</code>
		<ul style="margin-left: 70px;">
			<li>Button.<b>js</b> ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–æ–≤–µ–¥–µ–Ω–∏—è</li>
			<li>Button.<b>html</b> ‚Äî –®–∞–±–ª–æ–Ω</li>
			<li>Button.<b>scss</b> ‚Äî –°—Ç–∏–ª–∏</li>
			<li>Button.<b>spec.js</b> ‚Äî –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -80px">Button/Button.spec.js</h2>
		<pre class="js-code compact-s">
			export default {
				keywords: "btn –∫–Ω–æ–ø–∫–∞",
				cases: {
					"base": {
						attrs: [{text: "–ù–∞–ø–∏—Å–∞—Ç—å"}]
					},
					"primary": {
						attrs: [
							{type: "submit", text: "–ù–∞–ø–∏—Å–∞—Ç—å"},
							{ico: "compose", type: "submit", text: "–ù–∞–ø–∏—Å–∞—Ç—å"},
							{ico: "compose", short: true, type: "submit", text: "–ù–∞–ø–∏—Å–∞—Ç—å"},
							{pressed: true, type: "submit", text: "–ù–∞–ø–∏—Å–∞—Ç—å"}
						]
					},
				}
			};
		</pre>
	</div></section>

	<section class="slide shout"><div>
		<h2>–ë–ª–æ–∫–∏üíñÔ∏èJSSDK</h2>
	</div></section>

	<section class="slide"><div>
		<h2 style="margin-top: -50px;">–ë–ª–æ–∫–∏üíñÔ∏èJSSDK</h2>
		<div style="overflow: hidden;">
			<video controls loop autoplay style="margin-left: -50px; margin-right: -50px; width: calc(100% + 100px);">
				<source src="media/DatasetLetters.webm" type="video/webm"/>
				–ó–µ–≤—Å –≤—Å–µ–º–æ–≥—É—â–∏–π, –Ω—É –∫–∞–∫ —Ç–∞–∫-—Ç–æ.
			</video>
		</div>
	</div></section>

	<section class="slide"><div>
		<h2>–ë–ª–æ–∫–∏üíñÔ∏èJSSDK: <code>model</code> –∏ <code>models</code></h2>
		<pre class="js-code">
			// –°–ø–∏—Å–æ–∫ —Ç—Ä–µ–¥–æ–≤ —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Thread.List
			&lt;b:dataset-letters models="{attrs.model.threads}" />

			// –í—ã–≤–æ–¥ —Ç—Ä–µ–¥–∞
			&lt;b:thread model="{attrs.model.thread}" />
		</pre>
	</div></section>

	<section class="slide"><div>
		<h2>–ò—Ç–æ–≥–æ</h2>
		<ul>
			<li>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è <b>—Å–≤–µ—Ä—Ö—É &rarr; –≤–Ω–∏–∑</b></li>
			<li>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑ —á–µ—Ä–µ–∑ <b>custom-events</b></li>
			<li>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∫ –ø–æ–ª–Ω–æ–µ, —Ç–∞–∫ –∏ —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –º–æ–¥–µ–ª–∏/–∫–æ–ª–µ–∫—Ü–∏–∏</li>
		</ul>
	</div></section>

	<section class="slide shout"><div>
		<h2>–ì–¥–µ –ª–æ–≥–∏–∫–∞?</h2>
	</div></section>

	<section class="slide shout"><div>
		<h2>–ú–µ–¥–∏–∞—Ç–æ—Ä—ã</h2>
	</div></section>

	<section class="slide"><div>
		<h2>–ù–∞–ø—Ä–∏–º–µ—Ä</h2>
		<pre class="js-code">
			&lt;b:portal-menu
				#! use:mediator="letters-actions letters-selection"
			/>
			// ...
			&lt;b:thread
				model="{attrs.model}"
				#! use:mediator="letters-actions"
			/>
		</pre>
	</div></section>

	<section class="slide"><div>
		<pre style="margin-top: -60px" class="js-code compact-xs">
			// –î–µ–π—Å—Ç–≤–∏—è
			import MarkAsAction from "jssdk/mail/actions/MarkAs";
			import DeleteAction from "jssdk/mail/actions/Delete";
			#!+ // –î—Ä—É–≥–∏–µ –º–µ–¥–∏–∞—Ç–æ—Ä—ã
			#!- import lettersSelection from "mediator/letters-selection";

			#!+ export default feast.Mediator.create("letters-actions", {
				components: {
					#!+ "dataset-letters": {  // –∏–º—è –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –º–µ–¥–∏–∞—Ç–æ—Ä–∞
						#! "class": UIDatasetLetters, // &lt;b:dataset-letter/>
						#!+ // —Å–æ–±—ã—Ç–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –º–µ–¥–∏–∞—Ç–æ—Ä
						#!- "events": ["invert:unread", "delete", ...],
					#!- },
					#!+ "router": {
						"class": Pilot,
					#!- },
					// ...
				},
				handleEvent(evt) { /* ... */ },
				// ...
			#!- });
		</pre>
	</div></section>

	<section class="slide"><div>
		<pre style="margin-top: -30px" class="js-code compact-xxs">
			export default feast.Mediator.create("layout-manager", {
				components: { /* ... */ },
				handleEvent(evt) {
					// –¢–∏–ø —Å–æ–±—ã—Ç–∏—è
					const type = evt.type;
					// –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –æ—Ç –º–µ–¥–∏–∞—Ç–æ—Ä–∞ –æ—Ç–≤–µ—á–∞—é—â–µ–≥–æ –∑–∞ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∏—Å–µ–º
					const selectedModels = lettersSelection.getModels();
					#!+
					if (type === "delete") {
						#!+ DeleteAction.execute({models: selectedModels})
							.then(this._done)
						#!-	.catch(this._fail);
					} else if (type === "move") {
						// ...
					}
					#!-
					#!+ swipeManager.reset(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–≤–∞–π–ø—ã
					lettersSelection.reset(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ

					#!- // –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é `handleEvent`, –≤—Å–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Å –º–µ–¥–∏–∞—Ç–æ—Ä–æ–º –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã
				}
			});
		</pre>
	</div></section>

	<section class="slide cover"><div>
		<img src="media/app-struct-shot-idx-final.png" width="100%"/>
	</div></section>


	<section class="slide"><div>
		<h2>–°–µ—Ä–≤–∏—Å—ã</h2>
		<ul>
			<li><b>auth</b> ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–∏–ø–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (account, oauth) –∏ –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ª–æ–≥–∏–Ω–∞</li>
			<li><b>compose</b> ‚Äî —Ñ–æ—Ä–º–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –ø–∏—Å—å–º–∞ (–∑–∞–≥—Ä—É–∑–∫–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç –æ–∫–æ–Ω)</li>
			<li><b>viewer</b> ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π, –∞—Ä—Ö–∏–≤–æ–≤ –∏ –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö –∞—Ç–∞—á–µ–π</li>
			<li>–∏ —Ç.–ø.</li>
		</ul>
	</div></section>


	<section class="slide"><div>
		<h2>The End</h2>

		<div style="text-align: center; padding: 50px 0 80px; font-size: 200%;">
			–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ.
		</div>

		<a href="https://github.com/RubaXa">github.com/RubaXa</a><br/>
		<a href="https://twitter.com/ibnRubaXa">@ibnRubaXa</a>
	</div></section>

	<script src="../../shwr/shower.js"></script>
</body>
</html>
